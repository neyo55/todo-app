<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProTodo v1.4</title>
    
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://npmcdn.com/flatpickr/dist/themes/dark.css" disabled id="cal-dark-theme">
    
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/confirmDate/confirmDate.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/confirmDate/confirmDate.css">
</head>
<body class="light-mode">
    <div class="app-wrapper">
        <header class="app-header">
            <div class="brand">
                <h1 style="font-size: 1.5rem; font-weight: 800; color: var(--primary); cursor: pointer;" onclick="resetApp()">ProTodo</h1>
            </div>
            
            <div class="user-welcome hidden" id="user-header">
                <img src="https://via.placeholder.com/40" id="header-avatar" class="avatar-img">
                <span id="header-nickname">User</span>
            </div>

            <div class="header-actions">
                <button id="theme-toggle" title="Toggle Theme"><i class="fas fa-moon"></i></button>
                <button onclick="exportTodos()" title="Export CSV"><i class="fas fa-file-csv"></i></button>
                <button onclick="document.getElementById('import-file').click()" title="Import JSON"><i class="fas fa-file-upload"></i></button>
                <input type="file" id="import-file" class="hidden" accept=".json" onchange="importTodos(this)">
                <button id="profile-btn" title="Settings"><i class="fas fa-user-cog"></i></button>
                <button id="logout-btn" class="danger" title="Logout"><i class="fas fa-sign-out-alt"></i></button>
            </div>
        </header>

        <div class="tabs">
            <button class="active" data-view="todos" onclick="switchView('todos')">
                <i class="fas fa-list-check"></i> Tasks
            </button>
            <button data-view="dashboard" onclick="switchView('dashboard')">
                <i class="fas fa-chart-pie"></i> Dashboard
            </button>
        </div>

        <div id="todos-view">
            <div class="add-todo-card">
                <div class="input-group">
                    <input type="text" id="todo-title" placeholder="What needs to be done?">
                </div>
                <div class="input-group">
                    <textarea id="todo-notes" placeholder="Add details or notes..." rows="2"></textarea>
                </div>
                
                <div class="subtask-input-section" style="margin-bottom: 15px; padding: 10px; background: var(--input-bg); border-radius: 8px; border: 1px dashed var(--border);">
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="subtask-input" placeholder="Add a subtask (e.g. Buy Milk)" style="margin-bottom:0;">
                        <button onclick="addSubtaskFromInput()" style="background:var(--text-muted); color:white; border:none; padding:0 15px; border-radius:6px; cursor:pointer;"><i class="fas fa-plus"></i></button>
                    </div>
                    <ul id="pending-subtasks-list" style="list-style:none; padding:0; margin-top:10px;"></ul>
                </div>

                <div class="options-grid">
                    <select id="todo-priority">
                        <option value="low">Low Priority</option>
                        <option value="medium" selected>Medium Priority</option>
                        <option value="high">High Priority</option>
                    </select>
                    <input type="text" id="todo-due" placeholder="Select Date & Time">
                    <select id="todo-reminder">
                        <option value="2" selected>2m before</option>
                        <option value="5">5m before</option>
                        <option value="15">15m before</option>
                        <option value="30">30m before</option>
                        <option value="60">1h before</option>
                        <option value="1440">1 day before</option>
                    </select>
                    <select id="todo-category">
                        <option value="personal">Personal</option>
                        <option value="work">Work</option>
                        <option value="urgent">Urgent</option>
                        <option value="medical">Medical</option>
                        <option value="other">Other</option>
                    </select>
                    <select id="todo-recurrence">
                        <option value="never" selected>No Repeat</option>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                </div>
                
                <div style="display:flex; gap:10px;">
                    <button id="add-todo-btn" class="primary-btn" style="flex:1;"><i class="fas fa-plus"></i> Add Task</button>
                    <button id="cancel-edit-btn" class="primary-btn hidden" style="flex:0.3; background:var(--text-muted);" onclick="resetApp()">Cancel</button>
                </div>
            </div>

            <div class="controls-bar">
                <div class="bulk-wrapper">
                    <input type="checkbox" id="select-all" onclick="toggleSelectAll()">
                    <span id="bulk-bar" class="hidden">
                        <strong id="selected-count" style="color:var(--primary)">0</strong> selected
                        <button style="background:none; border:none; color:var(--danger); font-weight:bold; cursor:pointer; margin-left:10px; text-decoration: underline;" onclick="deleteSelected()">Delete</button>
                    </span>
                </div>
                
                <span id="current-filter-label" style="font-size:0.8rem; color:var(--text-muted); margin-right:10px;">Showing: All</span>
                
                <div style="position:fixed; top:-5000px; left:-5000px;">
                    <input type="text" name="fake_username_trap" tabindex="-1">
                    <input type="password" name="fake_password_trap" tabindex="-1">
                </div>
                <input type="text" 
                       id="search-input" 
                       placeholder="Search tasks..." 
                       style="width: 200px; margin:0;" 
                       onkeyup="renderTodos()" 
                       autocomplete="off" 
                       name="search_query_unique_id_123"
                       readonly 
                       onfocus="this.removeAttribute('readonly');">
            </div>
            
            <ul id="todo-list"></ul>
            
            <div id="empty-state" class="empty-state-container hidden">
                <i class="fas fa-clipboard-list empty-state-icon"></i>
                <p style="font-weight:600; margin-bottom:5px;">No tasks found</p>
            </div>
        </div>

        <div id="dashboard-view" class="hidden">
            <div class="stats-grid">
                <div class="stat-card clickable" onclick="filterByStatus('all')">
                    <h3>Total Tasks</h3>
                    <span id="stat-total" style="color:var(--primary)">0</span>
                </div>
                <div class="stat-card clickable" onclick="filterByStatus('completed')">
                    <h3>Completed</h3>
                    <span id="stat-completed" style="color:var(--success)">0</span>
                </div>
                <div class="stat-card clickable" onclick="filterByStatus('pending')">
                    <h3>Pending</h3>
                    <span id="stat-pending" style="color:var(--warning)">0</span>
                </div>
            </div>
            
            <div class="chart-section" style="text-align:center; padding-bottom:30px;">
                <h3 style="margin-bottom:15px; color:var(--text-muted);">Task Categories</h3>
                <div class="chart-container" style="display:flex; justify-content:center;">
                    <canvas id="category-chart" width="300" height="300"></canvas>
                </div>
                <div id="chart-legend" style="display:flex; justify-content:center; gap:15px; margin-top:15px; font-size:0.85rem;"></div>
            </div>
        </div>

        <div id="profile-view" class="hidden profile-container">
            <h2 style="margin-bottom: 25px; text-align:center;">Account Settings</h2>
            
            <div class="avatar-upload-section">
                <img src="https://via.placeholder.com/120" id="profile-preview" class="avatar-large">
                <label for="profile-avatar-input" class="upload-btn-label">
                    <i class="fas fa-camera"></i> Change Photo
                </label>
                <input type="file" id="profile-avatar-input" class="hidden" accept="image/*" onchange="previewImage(this)">
            </div>

            <div class="form-group">
                <label>Nickname</label>
                <input type="text" id="profile-nickname">
            </div>
            <div class="form-group">
                <label>Full Name</label>
                <input type="text" id="profile-name">
            </div>
            <div class="form-group">
                <label>Phone Number</label>
                <input 
                    type="tel" 
                    id="profile-phone" 
                    placeholder="+234..."
                    oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                >
            </div>
            <div class="form-group">
                <label>Timezone</label>
                <select id="profile-timezone">
                    <option value="Africa/Lagos">Africa/Lagos</option>
                    <option value="UTC">UTC</option>
                    <option value="Europe/London">London</option>
                </select>
            </div>
            <div class="form-group" style="border-top:1px solid var(--border); padding-top:20px; margin-top:20px;">
                <label>New Password (Optional)</label>
                <input type="password" id="profile-password">
            </div>

            <div class="profile-actions">
                <button onclick="saveProfile()" class="primary-btn" style="margin-top:0;">Save Changes</button>
                <button onclick="window.location.reload()" style="background:var(--input-bg); color:var(--text-main); border:1px solid var(--border); padding:12px; border-radius:8px; cursor:pointer; font-weight:600; width:100%; transition:background 0.2s;">Cancel</button>
            </div>
        </div>
    </div>

    <div id="details-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal" onclick="closeDetails()">&times;</span>
            <h2 id="dm-title" style="margin-bottom:10px;">Task Title</h2>
            <div id="dm-meta" class="modal-meta"></div>
            <p id="dm-notes" class="modal-notes hidden"></p>
            
            <div style="margin:20px 0;">
                <h4 style="margin-bottom:10px;">Subtasks & Progress</h4>
                <div id="dm-progress-section"></div>
                <div id="dm-subtasks-list" class="checklist-container" style="margin-top:15px;"></div>
            </div>
            
            <div class="modal-actions" style="text-align:right;">
                <button onclick="closeDetails()" class="primary-btn" style="width:auto; padding:10px 20px;">Close</button>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2026 ProTodo Inc.</p>
    </footer>

    <script src="script.js"></script>
</body>
</html>